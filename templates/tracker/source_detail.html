{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="card">
    <!-- Header -->
    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <h4 class="mb-0">{{ source.name }}</h4>
          {% if source.is_active %}
            <span class="badge bg-success">Active</span>
          {% else %}
            <span class="badge bg-secondary">Archived</span>
          {% endif %}
        </div>

        <div class="d-flex align-items-center gap-2">
          <a href="{% url 'edit_source' pk=source.id %}" class="btn btn-warning btn-sm">
            <i class="fas fa-edit me-1"></i> Edit
          </a>

          {% if source.is_active %}
            <a href="{% url 'toggle_source_active' pk=source.id %}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('Archive this source? You can restore it later.');">
              <i class="fas fa-archive me-1"></i> Archive
            </a>
          {% else %}
            <a href="{% url 'toggle_source_active' pk=source.id %}"
               class="btn btn-success btn-sm"
               onclick="return confirm('Restore this source?');">
              <i class="fas fa-undo me-1"></i> Restore
            </a>
          {% endif %}

          <a href="{% url 'view_event' event_id=source.event.id %}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i> Back to Event
          </a>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-6">
          <p><strong>Event:</strong>
            <a href="{% url 'view_event' event_id=source.event.id %}">{{ source.event.name }}</a>
          </p>
          <p><strong>Type:</strong> <span class="badge bg-info">{{ source.get_source_type_display }}</span></p>
          <p><strong>Date:</strong> {{ source.source_date|date:"Y-m-d" }}</p>

          <p class="mb-1"><strong>Potential Impact:</strong>
            {% if source.potential_impact == 'ESCALATING' %}
              <i class="fas fa-arrow-up text-danger"></i> Escalating
            {% elif source.potential_impact == 'MAINTAINING' %}
              <i class="fas fa-arrow-right text-warning"></i> Maintaining
            {% elif source.potential_impact == 'DECREASING' %}
              <i class="fas fa-arrow-down text-success"></i> Decreasing
            {% else %}
              <em>-</em>
            {% endif %}
          </p>
          {% if source.potential_impact_notes %}
            <div class="text-muted small">Notes: {{ source.potential_impact_notes }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <p><strong>Content:</strong></p>
          {% if source.link_or_file %}
            <a href="{{ source.link_or_file }}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-external-link-alt me-1"></i> Visit URL
            </a>
          {% elif source.file_upload %}
            <a href="{{ source.file_upload.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
              <i class="fas fa-download me-1"></i> Download File
            </a>
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </div>
      </div>

      <div class="mb-3">
        <h6>Summary</h6>
        <div class="border rounded p-3 bg-light">{{ source.summary|linebreaks }}</div>
      </div>

      {% if source.potential_impact_notes %}
        <div class="mb-3">
          <h6>Potential Impact Notes</h6>
          <div class="border rounded p-3 bg-light">{{ source.potential_impact_notes|linebreaks }}</div>
        </div>
      {% endif %}

      {% if is_pdf and source.file_upload %}
        <div class="mt-4">
          <h6>Preview (PDF)</h6>
          <iframe src="{{ source.file_upload.url }}" width="100%" height="600" style="border:1px solid #ddd;"></iframe>
        </div>
      {% endif %}
    </div>

    <!-- Footer -->
    <div class="card-footer d-flex justify-content-between small text-muted">
      <div>
        <strong>Created by:</strong> {{ source.created_by|default:"—" }} |
        <strong>Created:</strong> {{ source.created_at|date:"Y-m-d H:i" }}
      </div>
      <div>
        <strong>Updated:</strong> {{ source.updated_at|date:"Y-m-d H:i" }}
      </div>
    </div>
  </div>
</div>
{% endblock %}
