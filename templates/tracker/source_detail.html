{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="card">
    <!-- Header -->
    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <h4 class="mb-0">{{ source.name }}</h4>
          {% if source.is_active %}
            <span class="badge bg-success">Active</span>
          {% else %}
            <span class="badge bg-secondary">Archived</span>
          {% endif %}
        </div>

        <div class="d-flex align-items-center gap-2">
          <a href="{% url 'edit_source' pk=source.id %}" class="btn btn-warning btn-sm">
            <i class="fas fa-edit me-1"></i> Edit
          </a>

          {% if source.is_active %}
            <a href="{% url 'toggle_source_active' pk=source.id %}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('Archive this source? You can restore it later.');">
              <i class="fas fa-archive me-1"></i> Archive
            </a>
          {% else %}
            <a href="{% url 'toggle_source_active' pk=source.id %}"
               class="btn btn-success btn-sm"
               onclick="return confirm('Restore this source?');">
              <i class="fas fa-undo me-1"></i> Restore
            </a>
          {% endif %}

          <a href="{% url 'view_event' event_id=source.event.id %}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i> Back to Event
          </a>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="card-body">
      <!-- Source details - Rediseñado en tarjetas -->
      <div class="source-details-container mb-4 p-3 bg-light rounded">
        <h5 class="mb-3 border-bottom pb-2">Source Details</h5>
        <div class="row">
          <!-- Event -->
          <div class="col-md-3 mb-3">
            <div class="detail-card p-3 h-100 bg-white rounded shadow-sm">
              <div class="d-flex align-items-center mb-2">
                <i class="fas fa-calendar-alt text-primary me-2"></i>
                <strong class="text-muted">Event</strong>
              </div>
              <p class="mb-0 fw-bold">
                <a href="{% url 'view_event' event_id=source.event.id %}">{{ source.event.name }}</a>
              </p>
            </div>
          </div>
          
          <!-- Type -->
          <div class="col-md-3 mb-3">
            <div class="detail-card p-3 h-100 bg-white rounded shadow-sm">
              <div class="d-flex align-items-center mb-2">
                <i class="fas fa-tag text-info me-2"></i>
                <strong class="text-muted">Type</strong>
              </div>
              <p class="mb-0">
                <span class="badge bg-info">{{ source.get_source_type_display }}</span>
              </p>
            </div>
          </div>
          
          <!-- Date -->
          <div class="col-md-3 mb-3">
            <div class="detail-card p-3 h-100 bg-white rounded shadow-sm">
              <div class="d-flex align-items-center mb-2">
                <i class="fas fa-calendar-day text-success me-2"></i>
                <strong class="text-muted">Date</strong>
              </div>
              <p class="mb-0 fw-bold">{{ source.source_date|date:"Y-m-d" }}</p>
            </div>
          </div>
          
          <!-- Potential Impact -->
          <div class="col-md-3 mb-3">
            <div class="detail-card p-3 h-100 bg-white rounded shadow-sm">
              <div class="d-flex align-items-center mb-2">
                <i class="fas fa-chart-line text-warning me-2"></i>
                <strong class="text-muted">Potential Impact</strong>
              </div>
              <p class="mb-0 fw-bold">
                {% if source.potential_impact == 'ESCALATING' %}
                  <i class="fas fa-arrow-up text-danger"></i> Escalating
                {% elif source.potential_impact == 'MAINTAINING' %}
                  <i class="fas fa-arrow-right text-warning"></i> Maintaining
                {% elif source.potential_impact == 'DECREASING' %}
                  <i class="fas fa-arrow-down text-success"></i> Decreasing
                {% else %}
                  <em class="text-muted">-</em>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div class="content-container mb-4 p-3 bg-light rounded">
        <h5 class="mb-3 border-bottom pb-2">Content</h5>
        <div class="row">
          <div class="col-12">
            <div class="detail-card p-3 bg-white rounded shadow-sm">
              {% if source.link_or_file %}
                <a href="{{ source.link_or_file }}" target="_blank" class="btn btn-outline-primary">
                  <i class="fas fa-external-link-alt me-1"></i> Visit URL
                </a>
                <div class="mt-2 small text-muted">{{ source.link_or_file }}</div>
              {% elif source.file_upload %}
                <a href="{{ source.file_upload.url }}" target="_blank" class="btn btn-outline-secondary">
                  <i class="fas fa-download me-1"></i> Download File
                </a>
                <div class="mt-2 small text-muted">{{ source.file_upload.name }}</div>
              {% else %}
                <span class="text-muted">No content available</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Section -->
      <div class="summary-container mb-4 p-3 bg-light rounded">
        <h5 class="mb-3 border-bottom pb-2">Summary</h5>
        <div class="p-3 bg-white rounded shadow-sm">
          {{ source.summary|linebreaks }}
        </div>
      </div>

      <!-- Potential Impact Notes Section -->
      {% if source.potential_impact_notes %}
        <div class="notes-container mb-4 p-3 bg-light rounded">
          <h5 class="mb-3 border-bottom pb-2">Potential Impact Notes</h5>
          <div class="p-3 bg-white rounded shadow-sm">
            {{ source.potential_impact_notes|linebreaks }}
          </div>
        </div>
      {% endif %}

      <!-- PDF Preview Section -->
      {% if is_pdf and source.file_upload %}
        <div class="preview-container mt-4 p-3 bg-light rounded">
          <h5 class="mb-3 border-bottom pb-2">Preview (PDF)</h5>
          <div class="p-3 bg-white rounded shadow-sm">
            <iframe src="{{ source.file_upload.url }}" width="100%" height="600" style="border:1px solid #ddd; border-radius: 4px;"></iframe>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Footer -->
    <div class="card-footer d-flex justify-content-between small text-muted">
      <div>
        <strong>Created by:</strong> {{ source.created_by|default:"—" }} |
        <strong>Created:</strong> {{ source.created_at|date:"Y-m-d H:i" }}
      </div>
      <div>
        <strong>Updated:</strong> {{ source.updated_at|date:"Y-m-d H:i" }}
      </div>
    </div>
  </div>
</div>

<style>
  .detail-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid rgba(0,0,0,0.05);
  }
  
  .detail-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
  }
  
  .source-details-container,
  .content-container,
  .summary-container,
  .notes-container,
  .preview-container {
    background: linear-gradient(to right, #f8f9fa, #f0f4f8) !important;
  }
</style>
{% endblock %}