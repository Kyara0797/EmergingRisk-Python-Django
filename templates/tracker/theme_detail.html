{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="card">
    <!-- Header estilo Event Detail -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">{{ theme.name }}</h4>
      <div class="d-flex gap-2">
        <a href="{% url 'edit_theme' pk=theme.pk %}" class="btn btn-warning btn-sm">
          <i class="fas fa-edit me-1"></i> Edit Theme
        </a>
        <a href="{% url 'add_event' theme_pk=theme.pk %}" class="btn btn-light btn-sm">
          <i class="fas fa-plus me-1"></i> Add Event
        </a>
      </div>
    </div>

    <div class="card-body">
      <!-- Detalles del Theme -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h5>Theme Details</h5>
          <p><strong>Category:</strong> {{ theme.category }}</p>

          <p class="mb-1"><strong>Risk Rating:</strong></p>
          <span class="badge bg-{{ theme.get_risk_color }}">
            <i class="fas
              {% if theme.risk_rating == 'low' %}fa-arrow-down
              {% elif theme.risk_rating == 'moderate' %}fa-equals
              {% elif theme.risk_rating == 'high' %}fa-arrow-up
              {% elif theme.risk_rating == 'critical' %}fa-skull
              {% endif %} me-1"></i>
            {{ theme.get_risk_rating_display }}
          </span>

          {% if theme.onset_timeline %}
            <p class="mt-3"><strong>Onset timeline:</strong> {{ theme.get_onset_timeline_display|default:theme.onset_timeline }}</p>
          {% endif %}
        </div>

        <div class="col-md-6">
          <h5>Description</h5>
          <div class="border p-3 bg-light rounded">
            {{ theme.description|default:"None" }}
          </div>
        </div>
      </div>

      <!-- Eventos relacionados -->
      <div class="mt-2">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Related Events</h5>
          <small class="text-muted">
            {{ theme.events.count }} {{ theme.events.count|pluralize:"event,events" }}
          </small>
        </div>

        {% if theme.events.all %}
          <div class="table-responsive">
            <table class="table table-hover" id="themeEventsTable">
              <thead>
                <tr>
                  <th>Event Name</th>
                  <th>Date Identified</th>
                  <th>Risk Level</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for event in theme.events.all %}
                <tr>
                  <td>
                    <a href="{% url 'view_event' event_id=event.pk %}">{{ event.name }}</a>
                  </td>
                  <td>{{ event.date_identified|date:"Y-m-d" }}</td>
                  <td>
                    <span class="badge bg-{{ event.get_risk_color }}">
                      {{ event.get_risk_rating_display }}
                    </span>
                  </td>
                  <td class="text-end">
                    <a href="{% url 'edit_event' pk=event.pk %}" class="btn btn-sm btn-outline-warning" title="Edit">
                      <i class="fas fa-edit"></i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-1"></i>
            No events have been added to this theme yet.
            <a href="{% url 'add_event' theme_pk=theme.pk %}" class="alert-link">Add the first event</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // DataTables opcional si está cargado (mismo patrón que Event Detail)
  if (window.jQuery && $.fn.DataTable) {
    $(function () {
      $('#themeEventsTable').DataTable({
        order: [[1, 'desc']],
        language: {
          emptyTable: 'No events available',
          info: 'Showing _START_ to _END_ of _TOTAL_ events',
          infoEmpty: 'Showing 0 to 0 of 0 events',
          infoFiltered: '(filtered from _MAX_ total events)',
          lengthMenu: 'Show _MENU_ events',
          search: 'Search events:',
          paginate: { first: 'First', last: 'Last', next: 'Next', previous: 'Previous' }
        }
      });
    });
  }
</script>
{% endblock %}
